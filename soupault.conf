### Configuration file for the soupault website generator ###

## Global settings

[settings]
  verbose = true


  # Where generated files go
  build_dir = "build/"

  # Where page files are stored
  site_dir = "site/"

  # Where in the template the page content is inserted
  content_selector = "#content"

  default_template = "templates/main.html"

  # Page considered the section index
  index_page = "index"

  page_file_extensions = ["html", "inc", "md"]

  doctype = "<!DOCTYPE html>"

[preprocessors]
  md = "cmark"


## Plugin loading
[plugins]

[plugins.git-timestamp-container]
  file = "plugins/timestamp-fixup.lua"

[plugins.section-link-highlight]
  file = "plugins/section-link-highlight.lua"


## Autogenerated section index settings
[index]
  index = true
  index_selector = "#index"
  index_processor = "scripts/index.py"


## Widgets

[widgets]

# Takes the content of the first <h1> and inserts it into the <title>
[widgets.page-title]
  widget = "title"
  selector = "h1"
  default = "Daniil Baturin"
  append = " &mdash; Daniil Baturin"

# Simply inserts contents of templates/sections.inc into <div id="nav">
[widgets.nav-menu]
  widget = "include"
  selector = "div#nav"
  file = "templates/sections.inc"

# Highlights the link to the current section in the navigation menu
[widgets.section-link-highlight]
  after = "nav-menu"
  widget = "section-link-highlight"

  active_link_class = "nav-active"
  selector = "div#nav"

# Inserts a container for the "last-modified" widget
# Some pages have handwritten timestamps to reflect the time
# of the last significant modification.
# They have the timestamp in <div id="revision"> and should not
# have autogenerated timestamps.
# The plugin inserts a <div id="last-modified"> only if a page
# doesn't have <div id="revision">
[widgets.timestamp-fixup]
  widget = "git-timestamp-container"
  selector = "div#content"
  revision_selector = "div#revision"

# Extracts last modification date of a page from the git log
# and inserts into the element with id="git-timestamp"
# (can be any element with that id)
[widgets.last-modified]
  after = "timestamp-fixup"
  widget = "exec"
  selector = "#git-timestamp"
  command = "scripts/git-timestamp"

# Generates breadcrumbs and inserts them into <div id="breadcrumbs">
[widgets.breadcrumbs]
  widget = "breadcrumbs"
  selector = "div#breadcrumbs"
  prepend = ".. / "
  append = " /"
  between = " / "
  breadcrumb_template = "<a class=\"nav\"></a>"
  min_depth = 1

# Removes the breadcrumbs div if previous widget left it empty
[widgets.breadcrumbs-cleanup]
  widget = "delete_element"
  selector = "div#breadcrumbs"
  only_if_empty = true

  # Must run after breadcrumbs!
  after = "breadcrumbs"

# Moves all elements with class="footnote" to <div id="footnotes"> 
# and replaces them with numbered links.
[widgets.footnotes]
  widget = "footnotes"
  selector = "div#footnotes"
  footnote_selector = ".footnote"
  footnote_link_class = "footnote"
  back_links = true
  link_id_prepend = "footnote-"
  back_link_id_append = "-ref"

[widgets.table-of-contents]
  exclude_path_regex = '/index(.*)'

  widget = "toc"
  selector = "#generated-toc"

  min_level = 2

  toc_list_class = "toc"
  toc_class_levels = false

  numbered_list = true

  heading_links = true
  heading_link_text = "â†’ "
  heading_link_class = "here"

  use_heading_slug = true


## Page-specific overrides

# Explicitly limit the news script to the global index page
[widgets.site-news]
  page = "index.inc"

  widget = "exec"
  command = "scripts/git-news"
  selector = "#content"

# Include bnfgen.js only in /tools/bnfgen
# No other page needs it, and it's quite a sizeable chunk of JS
[widgets.bnfgen-script]
  path_regex = 'tools/bnfgen.(\.*)'

  widget = "insert_html"
  selector = "head"
  html = '<script src="/scripts/bnfgen.js"> </script>'
